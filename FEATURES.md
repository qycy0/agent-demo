# 🌟 行业智能通用运维模型2.0 - 功能总览

## 📊 版本历史

| 版本 | 日期 | 核心功能 |
|------|------|----------|
| v2.0 | 2024-12-01 | 基础对话、模型管理、工具管理 |
| v2.1 | 2024-12-02 | 参数优化、页面美化 |
| v2.2 | 2024-12-02 | 模型测试、图片上传 |
| v2.3 | 2024-12-02 | 流式输出、状态显示 |
| v2.4 | 2024-12-03 | 多图片、模型编辑、系统提示词 |
| v2.5 | 2024-12-03 | 工具调用系统（三种类型） |
| v2.6 | 2024-12-03 | 自动工具解析、清空缓存 |
| **v2.7** | **2024-12-03** | **MCP系统、详细信息展示** |

## 🎯 核心功能模块

### 1️⃣ 智能对话系统

**基础功能**:
- ✅ 多模型支持（OpenAI、Claude、自定义）
- ✅ 实时流式输出
- ✅ 对话历史管理
- ✅ 清空对话和缓存

**高级功能**:
- ✅ 多模态输入（图片、视频）
- ✅ 客户端图片压缩
- ✅ 多媒体展示（网格布局）
- ✅ 暂停/恢复生成

**参数控制**:
- Temperature (0-2)
- Max Tokens (1-8192)
- Top P (0-1)
- Presence Penalty (-2 to 2)
- Frequency Penalty (-2 to 2)

### 2️⃣ 模型管理系统

**注册功能**:
- ✅ 自定义显示名称
- ✅ 实际模型名配置
- ✅ API URL和Key
- ✅ 连接测试验证
- ✅ 模型类型选择

**编辑功能**:
- ✅ 系统提示词配置
- ✅ 模型卡片编辑
- ✅ 提示词状态显示
- ✅ 删除模型

### 3️⃣ 工具管理系统

**工具类型** (v2.5):
1. **内置工具**
   - get_current_time（获取时间）
   - calculate（计算器）
   - search_web（搜索示例）

2. **外部API工具**
   - 配置API URL
   - HTTP方法（GET/POST）
   - 请求头自定义
   - JSON Schema参数定义

3. **自定义代码工具**
   - Python代码编辑
   - 参数定义
   - 安全执行环境

**工具操作**:
- ✅ 注册新工具
- ✅ 启用/禁用工具
- ✅ 删除工具
- ✅ 手动执行测试

### 4️⃣ 自动工具解析 (v2.6)

**解析功能**:
- ✅ 三种格式支持
  - `<tool_call>JSON</tool_call>`
  - `<tool_call name="..." arguments='...'/>`
  - `function_name({...})`
- ✅ 自动提取和执行
- ✅ 结果可视化展示
- ✅ 错误处理

**展示效果**:
```
🔧 执行工具调用
━━━━━━━━━━━━━━━━━━
📍 calculate
参数: {"expression": "2+3"}
✅ 结果: {"value": 5}
```

### 5️⃣ MCP系统 (v2.7) ⭐ 最新

**核心功能**:
- ✅ 工具调用循环（多轮迭代）
- ✅ 自动协调模型和工具
- ✅ 完整过程记录
- ✅ 详细信息展示

**工作流程**:
```
用户消息 → 模型思考 → 工具1 → 结果
          ↓
        继续思考 → 工具2 → 结果
          ↓
        最终答案
```

**详情面板**:
- 📋 不显眼的详情按钮
- 💭 所有thinking内容
- 🔧 所有工具调用
- ✅ 执行结果和状态
- ⏱️ 时间戳记录

### 6️⃣ UI/UX优化

**页面风格**:
- ✅ 红白配色主题
- ✅ 现代化设计
- ✅ 响应式布局
- ✅ 流畅动画

**交互优化**:
- ✅ 用户/Agent头像
- ✅ 状态实时显示
- ✅ 思考内容展示
- ✅ 错误清晰提示

**媒体处理**:
- ✅ 多文件上传
- ✅ 即时预览
- ✅ 独立删除
- ✅ 网格排列

## 🔄 完整工作流程

### 场景1: 简单问答

```
1. 用户发送消息
2. 模型思考并回答
3. 显示最终答案
```

### 场景2: 单次工具调用（v2.6自动解析）

```
1. 用户: "帮我算2+3"
2. 模型输出: <think>使用计算器</think><tool_call>...</tool_call>
3. 系统自动解析并执行工具
4. 显示工具结果
5. 模型给出最终答案
```

### 场景3: 多轮工具调用（v2.7 MCP）

```
1. 用户: "现在几点？还有多久到8点？"
2. 【第1轮】
   - 模型思考: 需要获取时间
   - 调用: get_current_time
   - 结果: 14:30
3. 【第2轮】
   - 模型思考: 计算时间差
   - 调用: calculate("20-14.5")
   - 结果: 5.5
4. 【第3轮】
   - 模型思考: 整合信息
   - 最终答案: "现在14:30，还有5.5小时到8点"
5. 点击📋查看完整过程
```

## 📚 文档体系

| 文档 | 用途 | 推荐度 |
|------|------|--------|
| `README.md` | 项目概览和快速开始 | ⭐⭐⭐⭐⭐ |
| `FEATURES.md` | **本文档** - 功能总览 | ⭐⭐⭐⭐⭐ |
| `QUICKSTART_TOOLS.md` | 工具快速入门 | ⭐⭐⭐⭐ |
| `TOOL_API.md` | 工具API完整文档 | ⭐⭐⭐⭐ |
| `AUTO_TOOL_PARSE.md` | 自动解析使用指南 | ⭐⭐⭐⭐ |
| `MCP_GUIDE.md` | MCP系统完整指南 | ⭐⭐⭐⭐⭐ |
| `USAGE.md` | 详细使用说明 | ⭐⭐⭐ |
| `CHANGELOG.md` | 版本更新历史 | ⭐⭐⭐ |

## 🧪 测试脚本

| 脚本 | 功能 |
|------|------|
| `test_tools.py` | 测试工具系统 |
| `test_mcp.py` | 测试MCP系统 |

运行测试:
```bash
python test_tools.py
python test_mcp.py
```

## 🚀 快速开始

### 1. 安装依赖

```bash
cd /mnt/zhizhu/mobile-agent
bash start.sh
```

或手动:
```bash
pip install -r requirements.txt
python app.py
```

### 2. 访问网页

```
http://localhost:5000
```

### 3. 注册模型

```
模型管理 → 添加模型 → 填写信息 → 测试连接 → 保存
```

### 4. 注册工具

```
工具管理 → 添加工具 → 选择类型 → 配置 → 保存
```

### 5. 开始对话

```
智能对话 → 选择模型 → 启用工具 → 勾选自动解析 → 发送消息
```

### 6. 查看详情

```
点击消息右上角 📋 按钮 → 查看完整处理过程
```

## 💡 使用技巧

### 技巧1: 系统提示词

为模型配置系统提示词，教它如何使用工具:

```
你是智能助手，可以使用工具。

工具调用格式:
<tool_call>
{"name": "工具名", "arguments": {...}}
</tool_call>

可用工具:
- calculate: 计算表达式
- get_current_time: 获取时间
```

### 技巧2: 多步骤问题

问能展现MCP优势的问题:

- ✅ "现在几点？距离8点还有多久？"
- ✅ "帮我算2+3，然后乘以4"
- ✅ "查询天气，如果下雨计算备用方案"

### 技巧3: 查看详情

每次AI回复后:
1. 看右上角是否有 📋 按钮
2. 点击查看完整处理过程
3. 了解AI的思考和工具使用

### 技巧4: 媒体上传

上传图片或视频:
1. 按住Ctrl/Cmd多选
2. 自动压缩和预览
3. 可单独删除
4. 一起发送给模型

## 🔧 高级配置

### 修改MCP最大轮数

编辑 `mcp.py`:
```python
class MCPCoordinator:
    def __init__(self, ...):
        self.max_iterations = 10  # 改为你需要的值
```

### 添加内置工具

编辑 `app.py`:
```python
@register_builtin_tool('your_tool')
def tool_your_function(params):
    # 实现
    return {'success': True, 'result': ...}
```

然后在 `get_builtin_tools()` 添加Schema。

### 自定义样式

编辑 `static/style.css`:
- 修改主题色: `--primary-color`
- 调整布局间距
- 自定义详情面板样式

## 🔒 安全注意

1. **API Key保护**: 不要提交到版本控制
2. **代码工具**: 生产环境需要沙箱
3. **输入验证**: 所有工具都应验证参数
4. **超时设置**: API调用应有合理超时
5. **错误处理**: 防止敏感信息泄露

## 📈 性能优化

1. **图片压缩**: 自动压缩上传图片
2. **流式输出**: 实时显示，不等待完成
3. **事件驱动**: SSE异步传输
4. **按需加载**: 详情面板折叠显示
5. **缓存管理**: 定期清理上传文件

## 🐛 故障排查

### 问题1: MCP没有激活

**检查**:
- ✅ "自动解析工具调用"是否勾选
- ✅ 网络请求是否到 `/api/chat/mcp`
- ✅ 浏览器控制台有无错误

### 问题2: 工具没有被调用

**检查**:
- ✅ 工具是否在对话中勾选
- ✅ 模型输出格式是否正确
- ✅ 查看详情面板的解析结果
- ✅ 系统提示词是否清晰

### 问题3: 详情按钮不显示

**检查**:
- ✅ 是否启用MCP模式（勾选自动解析）
- ✅ 是否有处理过程（工具调用等）
- ✅ 浏览器是否支持（现代浏览器）

### 问题4: 媒体上传失败

**检查**:
- ✅ 文件大小是否过大
- ✅ 格式是否支持
- ✅ uploads目录是否有写权限
- ✅ 查看服务器日志

## 🎓 学习路径

### 入门（第1天）
1. 阅读 `README.md`
2. 运行 `start.sh` 启动
3. 注册一个模型
4. 发送简单对话

### 进阶（第2天）
1. 阅读 `QUICKSTART_TOOLS.md`
2. 注册内置工具
3. 尝试工具调用
4. 上传图片对话

### 高级（第3天）
1. 阅读 `AUTO_TOOL_PARSE.md`
2. 启用自动解析
3. 配置系统提示词
4. 测试工具调用

### 专家（第4天）
1. 阅读 `MCP_GUIDE.md`
2. 理解MCP架构
3. 测试多轮调用
4. 查看详细过程

### 定制（第5天）
1. 阅读 `TOOL_API.md`
2. 创建自定义工具
3. 修改MCP配置
4. 优化系统提示词

## 🌟 最佳实践

1. **清晰的系统提示**: 让模型知道如何使用工具
2. **合理的工具粒度**: 不要太复杂也不要太简单
3. **完善的错误处理**: 工具应该返回有用的错误信息
4. **定期清理缓存**: 使用"清空对话"功能
5. **查看详细过程**: 理解AI的思考方式
6. **测试再上线**: 使用测试脚本验证功能

## 📞 支持和反馈

- 📖 查看文档: `docs/` 目录
- 🧪 运行测试: `test_*.py` 脚本
- 📋 查看日志: `CHANGELOG.md`
- 🐛 提交Issue: GitHub Issues

---

**版本**: v2.7  
**更新**: 2024-12-03  
**作者**: MCP开发团队  

🎉 **感谢使用行业智能通用运维模型2.0！**
