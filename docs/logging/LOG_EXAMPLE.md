# ğŸ“‹ æ—¥å¿—ç³»ç»Ÿç¤ºä¾‹è¾“å‡º

## å®Œæ•´çš„è¯·æ±‚-å“åº”æ—¥å¿—ç¤ºä¾‹

### åœºæ™¯ï¼šç”¨æˆ·è¯¢é—®"ç°åœ¨å‡ ç‚¹ï¼Ÿ"

```log
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
1ï¸âƒ£  HTTP è¯·æ±‚å¼€å§‹
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

2024-12-04 12:00:00.123 [INFO] __main__ - â”â”â”â” æ–°è¯·æ±‚ â”â”â”â”
2024-12-04 12:00:00.124 [INFO] __main__ - Method: POST
2024-12-04 12:00:00.124 [INFO] __main__ - Path: /api/chat/mcp
2024-12-04 12:00:00.124 [INFO] __main__ - IP: 127.0.0.1
2024-12-04 12:00:00.125 [INFO] __main__ - Request Data: messages=[2 items], ...

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
2ï¸âƒ£  æ¨¡å‹è°ƒç”¨å¼€å§‹
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

2024-12-04 12:00:00.126 [INFO] __main__ - ğŸ¤– è°ƒç”¨æ¨¡å‹: GPT-4
2024-12-04 12:00:00.126 [DEBUG] __main__ -    æ¨¡å‹ç±»å‹: openai
2024-12-04 12:00:00.126 [DEBUG] __main__ -    URL: https://api.openai.com/v1
2024-12-04 12:00:00.126 [DEBUG] __main__ -    æ¶ˆæ¯æ•°é‡: 2
2024-12-04 12:00:00.126 [DEBUG] __main__ -    å·¥å…·æ•°é‡: 3
2024-12-04 12:00:00.126 [DEBUG] __main__ -    å‚æ•°: {
  'temperature': 0.7,
  'max_tokens': 2000,
  'top_p': 1.0,
  'presence_penalty': 0.0,
  'frequency_penalty': 0.0
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
3ï¸âƒ£  æ¨¡å‹è¯·æ±‚æ•°æ®ï¼ˆå‘é€ç»™ APIï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

2024-12-04 12:00:00.127 [DEBUG] __main__ -    è¯·æ±‚æ•°æ®: {
  "messages": [
    {
      "role": "system",
      "content": "ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹ï¼Œå¯ä»¥ä½¿ç”¨å·¥å…·æ¥å›ç­”é—®é¢˜ã€‚å½“éœ€è¦ä½¿ç”¨å·¥å…·æ—¶ï¼Œè¯·åœ¨<think>æ ‡ç­¾ä¸­æ€è€ƒï¼Œç„¶åä½¿ç”¨<tool_call>..."
    },
    {
      "role": "user",
      "content": "ç°åœ¨å‡ ç‚¹ï¼Ÿ"
    }
  ],
  "temperature": 0.7,
  "max_tokens": 2000,
  "top_p": 1.0,
  "stream": true,
  "model": "gpt-4-turbo-preview",
  "tools": [
    {
      "type": "function",
      "function": {
        "name": "get_current_time",
        "description": "è·å–å½“å‰æ—¥æœŸå’Œæ—¶é—´",
        "parameters": {
          "type": "object",
          "properties": {
            "timezone": {
              "type": "string",
              "description": "æ—¶åŒºï¼Œä¾‹å¦‚ 'Asia/Shanghai', 'UTC'"
            }
          }
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "calculate",
        "description": "è®¡ç®—æ•°å­¦è¡¨è¾¾å¼",
        "parameters": {...}
      }
    },
    {
      "type": "function",
      "function": {
        "name": "search_web",
        "description": "æœç´¢ç½‘ç»œä¿¡æ¯",
        "parameters": {...}
      }
    }
  ]
}

2024-12-04 12:00:00.128 [DEBUG] __main__ -    å‘é€è¯·æ±‚åˆ°: https://api.openai.com/v1/chat/completions
2024-12-04 12:00:00.129 [DEBUG] __main__ -    å“åº”çŠ¶æ€: 200

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
4ï¸âƒ£  MCP åè°ƒå¼€å§‹
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

2024-12-04 12:00:00.130 [INFO] mcp - ğŸ”„ MCPåè°ƒå¼€å§‹
2024-12-04 12:00:00.130 [DEBUG] mcp -    æ¶ˆæ¯æ•°é‡: 2
2024-12-04 12:00:00.130 [DEBUG] mcp -    å·¥å…·æ•°é‡: 3
2024-12-04 12:00:00.130 [DEBUG] mcp -    è‡ªåŠ¨è§£æ: True
2024-12-04 12:00:00.130 [DEBUG] mcp -    æœ€å¤§è¿­ä»£: 5

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
5ï¸âƒ£  ç¬¬ 1 è½®è¿­ä»£
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

2024-12-04 12:00:00.131 [INFO] mcp -    ğŸ” ç¬¬ 1 è½®è¿­ä»£å¼€å§‹

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
6ï¸âƒ£  æ¨¡å‹å“åº”ï¼ˆæµå¼è¾“å‡ºç´¯ç§¯ï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

2024-12-04 12:00:02.456 [INFO] __main__ -    âœ… æ¨¡å‹å“åº”å®Œæˆ (é•¿åº¦: 156 å­—ç¬¦)
2024-12-04 12:00:02.456 [DEBUG] __main__ -    å“åº”å†…å®¹: <think>ç”¨æˆ·è¯¢é—®æ—¶é—´ï¼Œæˆ‘éœ€è¦è°ƒç”¨get_current_timeå·¥å…·æ¥è·å–å½“å‰å‡†ç¡®æ—¶é—´</think><tool_call>{"name":"get_current_time","arguments":{"timezone":"Asia/Shanghai"}}</tool_call>

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
7ï¸âƒ£  å·¥å…·è°ƒç”¨æ‰§è¡Œ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

2024-12-04 12:00:02.457 [INFO] mcp -       ğŸ”§ æ‰§è¡Œå·¥å…·: get_current_time
2024-12-04 12:00:02.457 [DEBUG] mcp -          å‚æ•°: {"timezone":"Asia/Shanghai"}

2024-12-04 12:00:02.458 [INFO] __main__ - ğŸ”§ æ‰§è¡Œå·¥å…·è°ƒç”¨: get_current_time
2024-12-04 12:00:02.458 [DEBUG] __main__ -    å‚æ•°: {"timezone":"Asia/Shanghai"}
2024-12-04 12:00:02.459 [INFO] __main__ -    ä½¿ç”¨å†…ç½®å·¥å…·: get_current_time
2024-12-04 12:00:02.480 [INFO] __main__ -    âœ… æ‰§è¡ŒæˆåŠŸ (0.02s)
2024-12-04 12:00:02.480 [DEBUG] __main__ -    ç»“æœ: {
  "success": true,
  "result": {
    "datetime": "2024-12-04 12:00:02",
    "timezone": "Asia/Shanghai",
    "timestamp": 1733284802.456789,
    "iso": "2024-12-04T12:00:02.456789+08:00"
  }
}

2024-12-04 12:00:02.481 [INFO] mcp -          âœ… å·¥å…·æ‰§è¡ŒæˆåŠŸ
2024-12-04 12:00:02.481 [DEBUG] mcp -          ç»“æœ: {"success":true,"result":{"datetime":"2024-12-04 12:00:02"...

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
8ï¸âƒ£  ç¬¬ 2 è½®è¿­ä»£ï¼ˆåŸºäºå·¥å…·ç»“æœï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

2024-12-04 12:00:02.482 [INFO] mcp -    ğŸ” ç¬¬ 2 è½®è¿­ä»£å¼€å§‹

2024-12-04 12:00:03.123 [INFO] __main__ -    âœ… æ¨¡å‹å“åº”å®Œæˆ (é•¿åº¦: 45 å­—ç¬¦)
2024-12-04 12:00:03.123 [DEBUG] __main__ -    å“åº”å†…å®¹: ç°åœ¨æ˜¯2024å¹´12æœˆ4æ—¥ 12:00:02ï¼ŒåŒ—äº¬æ—¶é—´ã€‚

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
9ï¸âƒ£  è¯·æ±‚å®Œæˆ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

2024-12-04 12:00:03.124 [INFO] __main__ - Response Status: 200
2024-12-04 12:00:03.124 [INFO] __main__ - â”â”â”â” è¯·æ±‚ç»“æŸ â”â”â”â”
```

---

## å…³é”®æ—¥å¿—ç‚¹è¯´æ˜

### 1. æ¨¡å‹è¯·æ±‚æ•°æ®ï¼ˆDEBUGï¼‰

```log
2024-12-04 12:00:00.127 [DEBUG] __main__ -    è¯·æ±‚æ•°æ®: {
  "messages": [
    {"role": "system", "content": "ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹..."},
    {"role": "user", "content": "ç°åœ¨å‡ ç‚¹ï¼Ÿ"}
  ],
  "temperature": 0.7,
  "model": "gpt-4-turbo-preview",
  "tools": [...]
}
```

**åŒ…å«å†…å®¹**:
- âœ… å®Œæ•´çš„æ¶ˆæ¯åˆ—è¡¨ï¼ˆå«ç³»ç»Ÿæç¤ºè¯ï¼‰
- âœ… æ‰€æœ‰æ¨¡å‹å‚æ•°ï¼ˆtemperature, max_tokens ç­‰ï¼‰
- âœ… å·¥å…·å®šä¹‰åˆ—è¡¨
- âœ… æµå¼æ ‡å¿—

**æ³¨æ„**:
- æ¶ˆæ¯å†…å®¹ä¼šæˆªæ–­åˆ°100å­—ç¬¦ï¼ˆé¿å…æ—¥å¿—è¿‡å¤§ï¼‰
- å¤šæ¨¡æ€å†…å®¹æ˜¾ç¤ºä¸º `[multimodal]`

### 2. æ¨¡å‹å“åº”å†…å®¹ï¼ˆDEBUGï¼‰

```log
2024-12-04 12:00:02.456 [INFO] __main__ -    âœ… æ¨¡å‹å“åº”å®Œæˆ (é•¿åº¦: 156 å­—ç¬¦)
2024-12-04 12:00:02.456 [DEBUG] __main__ -    å“åº”å†…å®¹: <think>ç”¨æˆ·è¯¢é—®æ—¶é—´ï¼Œæˆ‘éœ€è¦è°ƒç”¨get_current_timeå·¥å…·æ¥è·å–å½“å‰å‡†ç¡®æ—¶é—´</think><tool_call>{"name":"get_current_time","arguments":{"timezone":"Asia/Shanghai"}}</tool_call>
```

**åŒ…å«å†…å®¹**:
- âœ… å®Œæ•´çš„æ¨¡å‹è¾“å‡ºï¼ˆæµå¼ç´¯ç§¯ï¼‰
- âœ… åŒ…å« thinking å†…å®¹
- âœ… åŒ…å«å·¥å…·è°ƒç”¨
- âœ… å“åº”é•¿åº¦ç»Ÿè®¡

**æ³¨æ„**:
- å¦‚æœå†…å®¹è¶…è¿‡500å­—ç¬¦ï¼Œä¼šæˆªæ–­å¹¶åŠ  `...`
- æµå¼è¾“å‡ºä¼šé€æ­¥ç´¯ç§¯ï¼Œæœ€åä¸€æ¬¡æ€§è®°å½•

### 3. å·¥å…·æ‰§è¡Œè¯¦æƒ…

```log
2024-12-04 12:00:02.458 [INFO] __main__ - ğŸ”§ æ‰§è¡Œå·¥å…·è°ƒç”¨: get_current_time
2024-12-04 12:00:02.458 [DEBUG] __main__ -    å‚æ•°: {"timezone":"Asia/Shanghai"}
2024-12-04 12:00:02.459 [INFO] __main__ -    ä½¿ç”¨å†…ç½®å·¥å…·: get_current_time
2024-12-04 12:00:02.480 [INFO] __main__ -    âœ… æ‰§è¡ŒæˆåŠŸ (0.02s)
2024-12-04 12:00:02.480 [DEBUG] __main__ -    ç»“æœ: {
  "success": true,
  "result": {
    "datetime": "2024-12-04 12:00:02",
    "timezone": "Asia/Shanghai",
    "timestamp": 1733284802.456789,
    "iso": "2024-12-04T12:00:02.456789+08:00"
  }
}
```

**åŒ…å«å†…å®¹**:
- âœ… å·¥å…·åç§°
- âœ… è¾“å…¥å‚æ•°ï¼ˆå®Œæ•´JSONï¼‰
- âœ… æ‰§è¡Œç±»å‹ï¼ˆå†…ç½®/API/ä»£ç ï¼‰
- âœ… æ‰§è¡Œæ—¶é—´ï¼ˆç²¾ç¡®åˆ°æ¯«ç§’ï¼‰
- âœ… è¿”å›ç»“æœï¼ˆå®Œæ•´JSONï¼Œé™åˆ¶500å­—ç¬¦ï¼‰

---

## ä¸åŒåœºæ™¯çš„æ—¥å¿—ç¤ºä¾‹

### åœºæ™¯ 1: ç®€å•å¯¹è¯ï¼ˆæ— å·¥å…·è°ƒç”¨ï¼‰

```log
2024-12-04 12:05:00 [INFO] __main__ - â”â”â”â” æ–°è¯·æ±‚ â”â”â”â”
2024-12-04 12:05:00 [INFO] __main__ - Method: POST
2024-12-04 12:05:00 [INFO] __main__ - Path: /api/chat/stream
2024-12-04 12:05:00 [INFO] __main__ - ğŸ¤– è°ƒç”¨æ¨¡å‹: GPT-4
2024-12-04 12:05:00 [DEBUG] __main__ -    è¯·æ±‚æ•°æ®: {
  "messages": [
    {"role": "user", "content": "ä½ å¥½"}
  ],
  "model": "gpt-4"
}
2024-12-04 12:05:01 [INFO] __main__ -    âœ… æ¨¡å‹å“åº”å®Œæˆ (é•¿åº¦: 15 å­—ç¬¦)
2024-12-04 12:05:01 [DEBUG] __main__ -    å“åº”å†…å®¹: ä½ å¥½ï¼æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ
2024-12-04 12:05:01 [INFO] __main__ - Response Status: 200
2024-12-04 12:05:01 [INFO] __main__ - â”â”â”â” è¯·æ±‚ç»“æŸ â”â”â”â”
```

### åœºæ™¯ 2: å¤šè½®å·¥å…·è°ƒç”¨

```log
2024-12-04 12:10:00 [INFO] __main__ - â”â”â”â” æ–°è¯·æ±‚ â”â”â”â”
2024-12-04 12:10:00 [INFO] __main__ - Path: /api/chat/mcp
2024-12-04 12:10:00 [INFO] mcp - ğŸ”„ MCPåè°ƒå¼€å§‹

â”â”â”â” ç¬¬ 1 è½® â”â”â”â”
2024-12-04 12:10:00 [INFO] mcp -    ğŸ” ç¬¬ 1 è½®è¿­ä»£å¼€å§‹
2024-12-04 12:10:00 [INFO] __main__ - ğŸ¤– è°ƒç”¨æ¨¡å‹: GPT-4
2024-12-04 12:10:00 [DEBUG] __main__ -    è¯·æ±‚æ•°æ®: {"messages":[...], "model":"gpt-4"}
2024-12-04 12:10:01 [INFO] __main__ -    âœ… æ¨¡å‹å“åº”å®Œæˆ (é•¿åº¦: 120 å­—ç¬¦)
2024-12-04 12:10:01 [DEBUG] __main__ -    å“åº”å†…å®¹: <think>éœ€è¦è·å–æ—¶é—´</think><tool_call>{"name":"get_current_time"}</tool_call>
2024-12-04 12:10:01 [INFO] mcp -       ğŸ”§ æ‰§è¡Œå·¥å…·: get_current_time
2024-12-04 12:10:01 [INFO] __main__ - ğŸ”§ æ‰§è¡Œå·¥å…·è°ƒç”¨: get_current_time
2024-12-04 12:10:01 [INFO] __main__ -    âœ… æ‰§è¡ŒæˆåŠŸ (0.02s)
2024-12-04 12:10:01 [DEBUG] __main__ -    ç»“æœ: {"success":true,"result":{"datetime":"12:10:01"}}

â”â”â”â” ç¬¬ 2 è½® â”â”â”â”
2024-12-04 12:10:01 [INFO] mcp -    ğŸ” ç¬¬ 2 è½®è¿­ä»£å¼€å§‹
2024-12-04 12:10:01 [INFO] __main__ - ğŸ¤– è°ƒç”¨æ¨¡å‹: GPT-4
2024-12-04 12:10:01 [DEBUG] __main__ -    è¯·æ±‚æ•°æ®: {"messages":[...å·¥å…·ç»“æœ...], "model":"gpt-4"}
2024-12-04 12:10:02 [INFO] __main__ -    âœ… æ¨¡å‹å“åº”å®Œæˆ (é•¿åº¦: 45 å­—ç¬¦)
2024-12-04 12:10:02 [DEBUG] __main__ -    å“åº”å†…å®¹: ç°åœ¨æ˜¯12:10:01ï¼ŒåŒ—äº¬æ—¶é—´ã€‚

2024-12-04 12:10:02 [INFO] __main__ - Response Status: 200
2024-12-04 12:10:02 [INFO] __main__ - â”â”â”â” è¯·æ±‚ç»“æŸ â”â”â”â”
```

### åœºæ™¯ 3: å·¥å…·è°ƒç”¨å¤±è´¥

```log
2024-12-04 12:15:00 [INFO] mcp -       ğŸ”§ æ‰§è¡Œå·¥å…·: nonexistent_tool
2024-12-04 12:15:00 [DEBUG] mcp -          å‚æ•°: {"query":"test"}
2024-12-04 12:15:00 [INFO] __main__ - ğŸ”§ æ‰§è¡Œå·¥å…·è°ƒç”¨: nonexistent_tool
2024-12-04 12:15:00 [DEBUG] __main__ -    å‚æ•°: {"query":"test"}
2024-12-04 12:15:00 [ERROR] __main__ -    âŒ å·¥å…·æœªæ³¨å†Œ: nonexistent_tool
2024-12-04 12:15:00 [ERROR] mcp -          âŒ å·¥å…·æ‰§è¡Œå¤±è´¥
```

### åœºæ™¯ 4: API è°ƒç”¨å¤±è´¥

```log
2024-12-04 12:20:00 [INFO] __main__ - ğŸ¤– è°ƒç”¨æ¨¡å‹: Claude
2024-12-04 12:20:00 [DEBUG] __main__ -    å‘é€è¯·æ±‚åˆ°: https://api.anthropic.com/v1/messages
2024-12-04 12:20:00 [DEBUG] __main__ -    å“åº”çŠ¶æ€: 500
2024-12-04 12:20:00 [ERROR] __main__ -    âŒ APIè°ƒç”¨å¤±è´¥: HTTP 500
2024-12-04 12:20:00 [ERROR] __main__ -    é”™è¯¯å“åº”: {"error": {"message": "Internal Server Error", "type": "internal_error"}}
```

### åœºæ™¯ 5: å¤–éƒ¨å·¥å…· API è°ƒç”¨

```log
2024-12-04 12:25:00 [INFO] __main__ - ğŸ”§ æ‰§è¡Œå·¥å…·è°ƒç”¨: weather_api
2024-12-04 12:25:00 [DEBUG] __main__ -    å‚æ•°: {"city":"Beijing"}
2024-12-04 12:25:00 [INFO] __main__ -    è°ƒç”¨å¤–éƒ¨API: POST https://api.weather.com/v1/current
2024-12-04 12:25:01 [INFO] __main__ -    âœ… APIè°ƒç”¨æˆåŠŸ (1.23s)
2024-12-04 12:25:01 [DEBUG] __main__ -    å“åº”: {"temperature":15,"condition":"sunny","humidity":45}
```

---

## æ—¥å¿—çº§åˆ«è¯´æ˜

### DEBUG çº§åˆ«ï¼ˆè¯¦ç»†ä¿¡æ¯ï¼‰

**åŒ…å«**:
- å®Œæ•´çš„è¯·æ±‚æ•°æ®
- å®Œæ•´çš„å“åº”å†…å®¹
- å·¥å…·æ‰§è¡Œç»“æœ
- æ‰€æœ‰å‚æ•°

**ç”¨é€”**:
- å¼€å‘è°ƒè¯•
- é—®é¢˜æ’æŸ¥
- æ€§èƒ½åˆ†æ

### INFO çº§åˆ«ï¼ˆå…³é”®æ“ä½œï¼‰

**åŒ…å«**:
- è¯·æ±‚å¼€å§‹/ç»“æŸ
- æ¨¡å‹è°ƒç”¨
- å·¥å…·æ‰§è¡Œ
- æˆåŠŸ/å¤±è´¥çŠ¶æ€
- æ‰§è¡Œæ—¶é—´

**ç”¨é€”**:
- ç›‘æ§ç³»ç»Ÿè¿è¡Œ
- è¿½è¸ªæ“ä½œæµç¨‹
- ç»Ÿè®¡ä½¿ç”¨æƒ…å†µ

### ERROR çº§åˆ«ï¼ˆé”™è¯¯ä¿¡æ¯ï¼‰

**åŒ…å«**:
- é”™è¯¯æè¿°
- é”™è¯¯è¯¦æƒ…
- å †æ ˆè·Ÿè¸ª

**ç”¨é€”**:
- å¿«é€Ÿå®šä½é—®é¢˜
- é”™è¯¯å‘Šè­¦
- é—®é¢˜ä¿®å¤

---

## å®ç”¨æŸ¥è¯¢å‘½ä»¤

### æŸ¥çœ‹å®Œæ•´çš„è¯·æ±‚-å“åº”å¯¹

```bash
# æŸ¥çœ‹æŸä¸ªè¯·æ±‚çš„å®Œæ•´æ—¥å¿—
grep -A 50 "â”â”â”â” æ–°è¯·æ±‚ â”â”â”â”" app.log | head -60

# æŸ¥çœ‹æ‰€æœ‰æ¨¡å‹è°ƒç”¨å’Œå“åº”
grep -E "ğŸ¤– è°ƒç”¨æ¨¡å‹|âœ… æ¨¡å‹å“åº”å®Œæˆ|å“åº”å†…å®¹:" app.log
```

### æŸ¥çœ‹æ¨¡å‹çš„è¾“å…¥å’Œè¾“å‡º

```bash
# æŸ¥çœ‹å‘é€ç»™æ¨¡å‹çš„æ•°æ®
grep "è¯·æ±‚æ•°æ®:" app.log -A 20

# æŸ¥çœ‹æ¨¡å‹çš„è¿”å›å†…å®¹
grep "å“åº”å†…å®¹:" app.log

# æŸ¥çœ‹ç‰¹å®šæ¨¡å‹çš„æ‰€æœ‰è°ƒç”¨
grep "è°ƒç”¨æ¨¡å‹: GPT-4" app.log -A 30
```

### æŸ¥çœ‹å·¥å…·è°ƒç”¨çš„å‚æ•°å’Œç»“æœ

```bash
# æŸ¥çœ‹æ‰€æœ‰å·¥å…·è°ƒç”¨
grep "ğŸ”§ æ‰§è¡Œå·¥å…·è°ƒç”¨:" app.log

# æŸ¥çœ‹ç‰¹å®šå·¥å…·çš„å‚æ•°å’Œç»“æœ
grep "æ‰§è¡Œå·¥å…·è°ƒç”¨: get_current_time" app.log -A 10

# ç»Ÿè®¡å·¥å…·è°ƒç”¨æˆåŠŸç‡
TOTAL=$(grep "ğŸ”§ æ‰§è¡Œå·¥å…·è°ƒç”¨:" app.log | wc -l)
SUCCESS=$(grep "âœ… æ‰§è¡ŒæˆåŠŸ" app.log | wc -l)
echo "å·¥å…·è°ƒç”¨æˆåŠŸç‡: $SUCCESS/$TOTAL"
```

### æ€§èƒ½åˆ†æ

```bash
# æŸ¥çœ‹æ‰€æœ‰æ‰§è¡Œæ—¶é—´
grep -o "([0-9.]*s)" app.log

# æŸ¥çœ‹æ…¢æ“ä½œï¼ˆè¶…è¿‡1ç§’ï¼‰
grep "([1-9][0-9]*\.[0-9]*s)" app.log

# ç»Ÿè®¡å¹³å‡å“åº”æ—¶é—´
grep "æ‰§è¡ŒæˆåŠŸ" app.log | grep -o "([0-9.]*s)" | sed 's/[()s]//g' | awk '{sum+=$1; count++} END {print "å¹³å‡:", sum/count, "ç§’"}'
```

---

## æ—¥å¿—é…ç½®è°ƒæ•´

### åªè®°å½• INFO åŠä»¥ä¸Šï¼ˆå‡å°‘æ—¥å¿—é‡ï¼‰

ä¿®æ”¹ `app.py`:
```python
logging.basicConfig(
    level=logging.INFO,  # æ”¹ä¸º INFO
    ...
)
```

**æ•ˆæœ**: ä¸è®°å½• DEBUG æ—¥å¿—ï¼ˆè¯·æ±‚æ•°æ®ã€å“åº”å†…å®¹ç­‰è¯¦ç»†ä¿¡æ¯ï¼‰

### åªè®°å½•åˆ°æ–‡ä»¶ï¼ˆä¸è¾“å‡ºåˆ°æ§åˆ¶å°ï¼‰

```python
logging.basicConfig(
    handlers=[
        logging.FileHandler('app.log', encoding='utf-8')
        # ç§»é™¤ logging.StreamHandler()
    ]
)
```

### åˆ†ç¦»é”™è¯¯æ—¥å¿—

```python
logging.basicConfig(
    handlers=[
        logging.FileHandler('app.log', encoding='utf-8'),
        logging.FileHandler('error.log', encoding='utf-8', level=logging.ERROR),
        logging.StreamHandler()
    ]
)
```

**æ•ˆæœ**: é”™è¯¯åŒæ—¶è®°å½•åˆ° `app.log` å’Œ `error.log`

---

## è°ƒè¯•ç¤ºä¾‹

### è°ƒè¯• 1: æ¨¡å‹ä¸ºä»€ä¹ˆæ²¡æœ‰è°ƒç”¨å·¥å…·ï¼Ÿ

```bash
# 1. æŸ¥çœ‹æ¨¡å‹è°ƒç”¨æ—¥å¿—
grep "ğŸ¤– è°ƒç”¨æ¨¡å‹" app.log -A 40

# 2. æ£€æŸ¥è¯·æ±‚æ•°æ®ä¸­æ˜¯å¦åŒ…å«å·¥å…·å®šä¹‰
grep "è¯·æ±‚æ•°æ®:" app.log -A 30 | grep -A 20 "tools"

# 3. æŸ¥çœ‹æ¨¡å‹çš„å“åº”
grep "å“åº”å†…å®¹:" app.log

# å¯èƒ½åŸå› :
# - å·¥å…·å®šä¹‰æ²¡æœ‰å‘é€ç»™æ¨¡å‹ âœ“ æ£€æŸ¥è¯·æ±‚æ•°æ®
# - æ¨¡å‹æ²¡æœ‰ç†è§£å¦‚ä½•è°ƒç”¨ âœ“ æ£€æŸ¥ç³»ç»Ÿæç¤ºè¯
# - æ¨¡å‹è®¤ä¸ºä¸éœ€è¦å·¥å…· âœ“ æ£€æŸ¥å“åº”å†…å®¹
```

### è°ƒè¯• 2: å·¥å…·æ‰§è¡Œå¤±è´¥

```bash
# 1. æŸ¥çœ‹å¤±è´¥çš„å·¥å…·
grep "âŒ.*å·¥å…·" app.log

# 2. æŸ¥çœ‹å…·ä½“é”™è¯¯
grep "æ‰§è¡Œå·¥å…·è°ƒç”¨: failed_tool" app.log -A 10

# 3. æ£€æŸ¥å‚æ•°æ˜¯å¦æ­£ç¡®
grep "æ‰§è¡Œå·¥å…·è°ƒç”¨: failed_tool" app.log -A 2 | grep "å‚æ•°:"

# 4. æŸ¥çœ‹é”™è¯¯å †æ ˆ
grep "ERROR" app.log -A 10 | grep -A 10 "failed_tool"
```

### è°ƒè¯• 3: å“åº”æ—¶é—´è¿‡é•¿

```bash
# 1. æŸ¥çœ‹æ‰€æœ‰æ‰§è¡Œæ—¶é—´
grep -o "([0-9.]*s)" app.log | sort -n | tail -20

# 2. æ‰¾å‡ºæœ€æ…¢çš„æ“ä½œ
grep "æ‰§è¡ŒæˆåŠŸ.*([1-9].*s)" app.log

# 3. åˆ†ææ—¶é—´åˆ†å¸ƒ
# æ¨¡å‹è°ƒç”¨æ—¶é—´
grep "ğŸ¤–" app.log -A 50 | grep "âœ… æ¨¡å‹å“åº”å®Œæˆ"

# å·¥å…·æ‰§è¡Œæ—¶é—´
grep "ğŸ”§ æ‰§è¡Œå·¥å…·è°ƒç”¨" app.log -A 5 | grep "âœ… æ‰§è¡ŒæˆåŠŸ"
```

---

## ç”Ÿäº§ç¯å¢ƒå»ºè®®

### 1. æ—¥å¿—çº§åˆ«è®¾ç½®

**å¼€å‘ç¯å¢ƒ**: DEBUG
```python
logging.basicConfig(level=logging.DEBUG, ...)
```

**ç”Ÿäº§ç¯å¢ƒ**: INFO
```python
logging.basicConfig(level=logging.INFO, ...)
```

**é«˜è´Ÿè½½ç”Ÿäº§**: WARNING
```python
logging.basicConfig(level=logging.WARNING, ...)
```

### 2. æ—¥å¿—è½®è½¬

```bash
# /etc/logrotate.d/mobile-agent
/mnt/zhizhu/mobile-agent/app.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
}
```

### 3. æ—¥å¿—ç›‘æ§

```bash
# å®æ—¶ç›‘æ§é”™è¯¯
tail -f app.log | grep --color ERROR

# é”™è¯¯å‘Šè­¦
while true; do
    if grep -q "ERROR" app.log; then
        echo "å‘ç°é”™è¯¯ï¼" | mail -s "Alert" admin@example.com
    fi
    sleep 300
done
```

---

**æ›´æ–°æ—¥æœŸ**: 2024-12-04  
**ç‰ˆæœ¬**: v2.0ï¼ˆå¢å¼ºç‰ˆï¼‰
