# ğŸ“¦ Built-in å·¥å…·å¼€å‘æŒ‡å—

æœ¬æŒ‡å—ä»‹ç»å¦‚ä½•åœ¨ç³»ç»Ÿä¸­æ·»åŠ å’Œç®¡ç†å†…ç½®ï¼ˆBuilt-inï¼‰å·¥å…·ã€‚

---

## ğŸ“‹ ç›®å½•

1. [ä»€ä¹ˆæ˜¯ Built-in å·¥å…·](#ä»€ä¹ˆæ˜¯-built-in-å·¥å…·)
2. [Built-in vs è‡ªå®šä¹‰å·¥å…·](#built-in-vs-è‡ªå®šä¹‰å·¥å…·)
3. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
4. [è¯¦ç»†æ­¥éª¤](#è¯¦ç»†æ­¥éª¤)
5. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
6. [ç¤ºä¾‹ï¼šå®Œæ•´çš„å·¥å…·å¼€å‘](#ç¤ºä¾‹å®Œæ•´çš„å·¥å…·å¼€å‘)
7. [å·¥å…·æµ‹è¯•](#å·¥å…·æµ‹è¯•)
8. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ä»€ä¹ˆæ˜¯ Built-in å·¥å…·

**Built-in å·¥å…·**æ˜¯ç›´æ¥é›†æˆåœ¨ç³»ç»Ÿä»£ç ä¸­çš„å·¥å…·ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

- âœ… **é«˜æ€§èƒ½**: ç›´æ¥åœ¨ Python ä¸­æ‰§è¡Œï¼Œæ— éœ€ç½‘ç»œè¯·æ±‚
- âœ… **å®‰å…¨æ€§**: ç»è¿‡ä»£ç å®¡æŸ¥ï¼Œå¯ä¿¡èµ–
- âœ… **ç¨³å®šæ€§**: éšç³»ç»Ÿä¸€èµ·éƒ¨ç½²å’Œç‰ˆæœ¬æ§åˆ¶
- âœ… **åŠŸèƒ½å¼ºå¤§**: å¯ä»¥è®¿é—®ç³»ç»Ÿèµ„æºå’Œåº“
- âœ… **æ— éœ€é…ç½®**: å¼€ç®±å³ç”¨ï¼Œç”¨æˆ·æ— éœ€è®¾ç½®

**å…¸å‹ç”¨é€”**:
- æ—¶é—´æ—¥æœŸå¤„ç†
- æ•°å­¦è®¡ç®—
- æ–‡ä»¶æ“ä½œ
- æ•°æ®æ ¼å¼è½¬æ¢
- ç³»ç»Ÿä¿¡æ¯æŸ¥è¯¢

---

## Built-in vs è‡ªå®šä¹‰å·¥å…·

| ç‰¹æ€§ | Built-in å·¥å…· | è‡ªå®šä¹‰å·¥å…· |
|------|---------------|------------|
| æ·»åŠ æ–¹å¼ | ä¿®æ”¹ä»£ç  | é¡µé¢é…ç½® |
| éƒ¨ç½² | éœ€è¦é‡å¯æœåŠ¡ | å³æ—¶ç”Ÿæ•ˆ |
| æ€§èƒ½ | é«˜ï¼ˆæœ¬åœ°æ‰§è¡Œï¼‰ | å–å†³äºå®ç° |
| å®‰å…¨æ€§ | é«˜ï¼ˆä»£ç å®¡æŸ¥ï¼‰ | å–å†³äºé…ç½® |
| çµæ´»æ€§ | ä½ï¼ˆéœ€è¦å‘ç‰ˆï¼‰ | é«˜ï¼ˆéšæ—¶ä¿®æ”¹ï¼‰ |
| é€‚ç”¨åœºæ™¯ | æ ¸å¿ƒåŠŸèƒ½ | ç‰¹å®šä¸šåŠ¡ |

**é€‰æ‹©å»ºè®®**:
- **Built-in**: é€šç”¨ã€æ ¸å¿ƒã€é«˜é¢‘ä½¿ç”¨çš„åŠŸèƒ½
- **è‡ªå®šä¹‰**: ç‰¹å®šä¸šåŠ¡ã€å®éªŒæ€§ã€å¤–éƒ¨APIè°ƒç”¨

---

## å¿«é€Ÿå¼€å§‹

### æ–¹æ³• 1: ç›´æ¥åœ¨ app.py ä¸­æ·»åŠ ï¼ˆç®€å•ï¼‰

**æ­¥éª¤**:

1. æ‰“å¼€ `app.py`
2. æ‰¾åˆ° "å†…ç½®å·¥å…·å®ç°" éƒ¨åˆ†ï¼ˆçº¦ç¬¬ 305 è¡Œï¼‰
3. æ·»åŠ æ–°å·¥å…·å‡½æ•°
4. æ›´æ–° `get_builtin_tools()` ä¸­çš„ schema
5. é‡å¯æœåŠ¡

**ç¤ºä¾‹**:
```python
# 1. åœ¨ app.py ä¸­æ·»åŠ å·¥å…·å®ç°
@register_builtin_tool('string_reverse')
def tool_string_reverse(params):
    """åè½¬å­—ç¬¦ä¸²"""
    text = params.get('text', '')
    return {
        'success': True,
        'result': text[::-1]
    }

# 2. åœ¨ get_builtin_tools() ä¸­æ·»åŠ  schema
builtin_schemas = {
    # ... ç°æœ‰å·¥å…·
    'string_reverse': {
        'name': 'string_reverse',
        'description': 'åè½¬å­—ç¬¦ä¸²',
        'parameters': {
            'type': 'object',
            'properties': {
                'text': {
                    'type': 'string',
                    'description': 'è¦åè½¬çš„å­—ç¬¦ä¸²'
                }
            },
            'required': ['text']
        }
    }
}
```

**ä¼˜ç‚¹**: å¿«é€Ÿã€ç®€å•  
**ç¼ºç‚¹**: æ‰€æœ‰å·¥å…·åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä¸åˆ©äºç®¡ç†

---

### æ–¹æ³• 2: æ¨¡å—åŒ–ç»“æ„ï¼ˆæ¨èï¼‰

**ç›®å½•ç»“æ„**:
```
mobile-agent/
â”œâ”€â”€ app.py
â”œâ”€â”€ builtin_tools/              # æ–°å»ºç›®å½•
â”‚   â”œâ”€â”€ __init__.py            # å·¥å…·åŠ è½½å™¨
â”‚   â”œâ”€â”€ schemas.json           # å·¥å…· Schema é…ç½®
â”‚   â”œâ”€â”€ datetime_tools.py      # æ—¶é—´æ—¥æœŸå·¥å…·
â”‚   â”œâ”€â”€ math_tools.py          # æ•°å­¦è®¡ç®—å·¥å…·
â”‚   â”œâ”€â”€ string_tools.py        # å­—ç¬¦ä¸²å¤„ç†å·¥å…·
â”‚   â””â”€â”€ file_tools.py          # æ–‡ä»¶æ“ä½œå·¥å…·
â””â”€â”€ ...
```

**ä¼˜ç‚¹**: 
- âœ… ç»“æ„æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤
- âœ… å·¥å…·åˆ†ç±»æ˜ç¡®
- âœ… ä¾¿äºå›¢é˜Ÿåä½œ
- âœ… æ”¯æŒå•å…ƒæµ‹è¯•

---

## è¯¦ç»†æ­¥éª¤

### æ­¥éª¤ 1: åˆ›å»ºç›®å½•ç»“æ„

```bash
cd /mnt/zhizhu/mobile-agent
mkdir -p builtin_tools
touch builtin_tools/__init__.py
touch builtin_tools/schemas.json
```

### æ­¥éª¤ 2: åˆ›å»ºå·¥å…·æ–‡ä»¶

**ç¤ºä¾‹**: `builtin_tools/string_tools.py`

```python
"""
å­—ç¬¦ä¸²å¤„ç†å·¥å…·é›†
"""

def string_reverse(params):
    """
    åè½¬å­—ç¬¦ä¸²
    
    Args:
        params (dict): åŒ…å« 'text' å­—æ®µçš„å­—å…¸
    
    Returns:
        dict: åŒ…å« success å’Œ result çš„å­—å…¸
    """
    text = params.get('text', '')
    return {
        'success': True,
        'result': text[::-1]
    }


def string_to_upper(params):
    """
    è½¬æ¢ä¸ºå¤§å†™
    
    Args:
        params (dict): åŒ…å« 'text' å­—æ®µçš„å­—å…¸
    
    Returns:
        dict: åŒ…å« success å’Œ result çš„å­—å…¸
    """
    text = params.get('text', '')
    return {
        'success': True,
        'result': text.upper()
    }


def string_to_lower(params):
    """
    è½¬æ¢ä¸ºå°å†™
    """
    text = params.get('text', '')
    return {
        'success': True,
        'result': text.lower()
    }
```

### æ­¥éª¤ 3: å®šä¹‰ Schema

**æ–‡ä»¶**: `builtin_tools/schemas.json`

```json
{
    "string_reverse": {
        "name": "string_reverse",
        "description": "åè½¬å­—ç¬¦ä¸²",
        "category": "string",
        "parameters": {
            "type": "object",
            "properties": {
                "text": {
                    "type": "string",
                    "description": "è¦åè½¬çš„å­—ç¬¦ä¸²"
                }
            },
            "required": ["text"]
        }
    },
    "string_to_upper": {
        "name": "string_to_upper",
        "description": "å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¤§å†™",
        "category": "string",
        "parameters": {
            "type": "object",
            "properties": {
                "text": {
                    "type": "string",
                    "description": "è¦è½¬æ¢çš„å­—ç¬¦ä¸²"
                }
            },
            "required": ["text"]
        }
    },
    "string_to_lower": {
        "name": "string_to_lower",
        "description": "å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå°å†™",
        "category": "string",
        "parameters": {
            "type": "object",
            "properties": {
                "text": {
                    "type": "string",
                    "description": "è¦è½¬æ¢çš„å­—ç¬¦ä¸²"
                }
            },
            "required": ["text"]
        }
    }
}
```

### æ­¥éª¤ 4: åˆ›å»ºåŠ è½½å™¨

**æ–‡ä»¶**: `builtin_tools/__init__.py`

```python
"""
Built-in å·¥å…·åŠ è½½å™¨
è‡ªåŠ¨å‘ç°å’Œæ³¨å†Œæ‰€æœ‰å†…ç½®å·¥å…·
"""

import os
import json
import importlib
from pathlib import Path

# å·¥å…·æ³¨å†Œè¡¨
BUILTIN_TOOLS = {}
BUILTIN_SCHEMAS = {}

def load_tools():
    """
    åŠ è½½æ‰€æœ‰å†…ç½®å·¥å…·
    """
    current_dir = Path(__file__).parent
    
    # 1. åŠ è½½ schemas
    schema_file = current_dir / 'schemas.json'
    if schema_file.exists():
        with open(schema_file, 'r', encoding='utf-8') as f:
            BUILTIN_SCHEMAS.update(json.load(f))
    
    # 2. è‡ªåŠ¨å‘ç°å¹¶åŠ è½½æ‰€æœ‰å·¥å…·æ¨¡å—
    for file in current_dir.glob('*_tools.py'):
        module_name = file.stem  # ä¾‹å¦‚: string_tools
        module = importlib.import_module(f'builtin_tools.{module_name}')
        
        # è·å–æ¨¡å—ä¸­çš„æ‰€æœ‰å‡½æ•°
        for name in dir(module):
            if not name.startswith('_'):  # å¿½ç•¥ç§æœ‰å‡½æ•°
                func = getattr(module, name)
                if callable(func):
                    BUILTIN_TOOLS[name] = func
                    print(f"âœ“ åŠ è½½å·¥å…·: {name}")
    
    print(f"âœ“ å…±åŠ è½½ {len(BUILTIN_TOOLS)} ä¸ªå†…ç½®å·¥å…·")
    return BUILTIN_TOOLS, BUILTIN_SCHEMAS


def get_tool(name):
    """è·å–æŒ‡å®šå·¥å…·"""
    return BUILTIN_TOOLS.get(name)


def get_schema(name):
    """è·å–å·¥å…·çš„ Schema"""
    return BUILTIN_SCHEMAS.get(name)


def list_tools():
    """åˆ—å‡ºæ‰€æœ‰å·¥å…·"""
    return list(BUILTIN_TOOLS.keys())


def list_schemas():
    """åˆ—å‡ºæ‰€æœ‰ Schema"""
    return list(BUILTIN_SCHEMAS.values())


# è‡ªåŠ¨åŠ è½½
load_tools()
```

### æ­¥éª¤ 5: ä¿®æ”¹ app.py ä½¿ç”¨æ–°ç»“æ„

åœ¨ `app.py` é¡¶éƒ¨å¯¼å…¥ï¼š

```python
# åœ¨ app.py å¼€å¤´æ·»åŠ 
try:
    from builtin_tools import BUILTIN_TOOLS, BUILTIN_SCHEMAS, list_schemas
    print("âœ“ ä½¿ç”¨æ¨¡å—åŒ– Built-in å·¥å…·")
except ImportError:
    # é™çº§åˆ°åŸæœ‰çš„å†…è”å®šä¹‰
    print("âœ“ ä½¿ç”¨å†…è” Built-in å·¥å…·")
    BUILTIN_TOOLS = {}
    BUILTIN_SCHEMAS = {}
    
    # ä¿ç•™åŸæœ‰çš„ register_builtin_tool å’Œå·¥å…·å®šä¹‰
    # ...
```

ä¿®æ”¹ `get_builtin_tools()` å‡½æ•°ï¼š

```python
@app.route('/api/tools/builtin', methods=['GET'])
def get_builtin_tools():
    """è·å–å†…ç½®å·¥å…·åˆ—è¡¨"""
    try:
        # å°è¯•ä½¿ç”¨æ¨¡å—åŒ–çš„ schemas
        from builtin_tools import list_schemas
        builtin_tools = list_schemas()
    except ImportError:
        # é™çº§åˆ°åŸæœ‰çš„ builtin_schemas
        builtin_tools = []
        for name in BUILTIN_TOOLS.keys():
            if name in builtin_schemas:
                builtin_tools.append(builtin_schemas[name])
    
    return jsonify({'success': True, 'tools': builtin_tools})
```

### æ­¥éª¤ 6: é‡å¯æœåŠ¡

```bash
cd /mnt/zhizhu/mobile-agent
# åœæ­¢ç°æœ‰æœåŠ¡
pkill -f "python.*app.py"

# å¯åŠ¨æœåŠ¡
python app.py

# æˆ–ä½¿ç”¨ start.sh
./start.sh
```

---

## æœ€ä½³å®è·µ

### 1. å‘½åè§„èŒƒ

**å·¥å…·åç§°**:
- ä½¿ç”¨å°å†™å­—æ¯ + ä¸‹åˆ’çº¿
- åŠ¨è¯å¼€å¤´ï¼Œæè¿°æ€§å¼º
- ä¾‹å¦‚: `get_current_time`, `calculate_sum`, `convert_json`

**æ–‡ä»¶åç§°**:
- æŒ‰åŠŸèƒ½åˆ†ç±»: `{category}_tools.py`
- ä¾‹å¦‚: `datetime_tools.py`, `math_tools.py`

### 2. å‡½æ•°ç­¾å

```python
def tool_name(params: dict) -> dict:
    """
    å·¥å…·æè¿°ï¼ˆä¸€å¥è¯ï¼‰
    
    Args:
        params (dict): å‚æ•°å­—å…¸
            - param1 (type): å‚æ•°1è¯´æ˜
            - param2 (type): å‚æ•°2è¯´æ˜
    
    Returns:
        dict: ç»“æœå­—å…¸
            - success (bool): æ˜¯å¦æˆåŠŸ
            - result (any): ç»“æœæ•°æ®
            - error (str): é”™è¯¯ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
    
    Example:
        >>> tool_name({'param1': 'value1'})
        {'success': True, 'result': 'output'}
    """
    try:
        # å‚æ•°éªŒè¯
        if 'required_param' not in params:
            return {
                'success': False,
                'error': 'ç¼ºå°‘å¿…éœ€å‚æ•°: required_param'
            }
        
        # ä¸šåŠ¡é€»è¾‘
        result = do_something(params)
        
        # è¿”å›ç»“æœ
        return {
            'success': True,
            'result': result
        }
        
    except Exception as e:
        # é”™è¯¯å¤„ç†
        return {
            'success': False,
            'error': str(e)
        }
```

### 3. å‚æ•°éªŒè¯

```python
def validate_params(params, required_keys, optional_keys=None):
    """
    å‚æ•°éªŒè¯è¾…åŠ©å‡½æ•°
    """
    # æ£€æŸ¥å¿…éœ€å‚æ•°
    for key in required_keys:
        if key not in params:
            raise ValueError(f'ç¼ºå°‘å¿…éœ€å‚æ•°: {key}')
    
    # æ£€æŸ¥å‚æ•°ç±»å‹
    if optional_keys:
        for key in params:
            if key not in required_keys and key not in optional_keys:
                raise ValueError(f'æœªçŸ¥å‚æ•°: {key}')
    
    return True


def example_tool(params):
    try:
        validate_params(params, required_keys=['text'], optional_keys=['format'])
        # ... ä¸šåŠ¡é€»è¾‘
    except ValueError as e:
        return {'success': False, 'error': str(e)}
```

### 4. é”™è¯¯å¤„ç†

```python
def safe_tool(params):
    """
    å®‰å…¨çš„å·¥å…·è°ƒç”¨ï¼ŒåŒ…å«å®Œæ•´é”™è¯¯å¤„ç†
    """
    try:
        # 1. å‚æ•°éªŒè¯
        if 'input' not in params:
            return {
                'success': False,
                'error': 'ç¼ºå°‘ input å‚æ•°',
                'error_type': 'validation'
            }
        
        # 2. ä¸šåŠ¡é€»è¾‘
        result = process(params['input'])
        
        # 3. ç»“æœéªŒè¯
        if result is None:
            return {
                'success': False,
                'error': 'å¤„ç†å¤±è´¥ï¼Œç»“æœä¸ºç©º',
                'error_type': 'processing'
            }
        
        # 4. æˆåŠŸè¿”å›
        return {
            'success': True,
            'result': result,
            'metadata': {
                'processed_at': datetime.now().isoformat(),
                'version': '1.0'
            }
        }
        
    except ValueError as e:
        return {
            'success': False,
            'error': f'å‚æ•°é”™è¯¯: {str(e)}',
            'error_type': 'validation'
        }
    except Exception as e:
        import traceback
        return {
            'success': False,
            'error': f'ç³»ç»Ÿé”™è¯¯: {str(e)}',
            'error_type': 'system',
            'traceback': traceback.format_exc()  # ä»…è°ƒè¯•æ—¶ä½¿ç”¨
        }
```

### 5. Schema è®¾è®¡

```json
{
    "tool_name": {
        "name": "tool_name",
        "description": "å·¥å…·çš„ç®€çŸ­æè¿°ï¼ˆä¸€å¥è¯ï¼‰",
        "category": "å·¥å…·ç±»åˆ«ï¼ˆdatetime/math/stringç­‰ï¼‰",
        "version": "1.0",
        "parameters": {
            "type": "object",
            "properties": {
                "param1": {
                    "type": "string|number|boolean|array|object",
                    "description": "å‚æ•°æè¿°",
                    "default": "é»˜è®¤å€¼ï¼ˆå¯é€‰ï¼‰",
                    "enum": ["é€‰é¡¹1", "é€‰é¡¹2"],
                    "minimum": 0,
                    "maximum": 100
                }
            },
            "required": ["param1"],
            "additionalProperties": false
        },
        "returns": {
            "type": "object",
            "description": "è¿”å›å€¼æè¿°"
        },
        "examples": [
            {
                "input": {"param1": "value1"},
                "output": {"success": true, "result": "output1"}
            }
        ]
    }
}
```

---

## ç¤ºä¾‹ï¼šå®Œæ•´çš„å·¥å…·å¼€å‘

### ç¤ºä¾‹ 1: æ–‡ä»¶å·¥å…·

**æ–‡ä»¶**: `builtin_tools/file_tools.py`

```python
"""
æ–‡ä»¶æ“ä½œå·¥å…·é›†
"""

import os
import json
from pathlib import Path

def file_read(params):
    """
    è¯»å–æ–‡ä»¶å†…å®¹
    
    Args:
        params (dict):
            - path (str): æ–‡ä»¶è·¯å¾„
            - encoding (str): ç¼–ç ï¼ˆé»˜è®¤ utf-8ï¼‰
    
    Returns:
        dict: åŒ…å«æ–‡ä»¶å†…å®¹çš„ç»“æœ
    """
    try:
        path = params.get('path')
        encoding = params.get('encoding', 'utf-8')
        
        if not path:
            return {'success': False, 'error': 'ç¼ºå°‘ path å‚æ•°'}
        
        # å®‰å…¨æ£€æŸ¥ï¼šåªå…è®¸è¯»å–ç‰¹å®šç›®å½•
        allowed_dir = '/mnt/zhizhu/mobile-agent/data'
        abs_path = os.path.abspath(path)
        if not abs_path.startswith(allowed_dir):
            return {
                'success': False,
                'error': f'ä¸å…è®¸è®¿é—®ç›®å½•: {abs_path}'
            }
        
        with open(path, 'r', encoding=encoding) as f:
            content = f.read()
        
        return {
            'success': True,
            'result': {
                'content': content,
                'size': len(content),
                'lines': content.count('\n') + 1
            }
        }
        
    except FileNotFoundError:
        return {'success': False, 'error': f'æ–‡ä»¶ä¸å­˜åœ¨: {path}'}
    except Exception as e:
        return {'success': False, 'error': str(e)}


def file_list(params):
    """
    åˆ—å‡ºç›®å½•ä¸­çš„æ–‡ä»¶
    """
    try:
        path = params.get('path', '.')
        pattern = params.get('pattern', '*')
        
        files = []
        for p in Path(path).glob(pattern):
            files.append({
                'name': p.name,
                'path': str(p),
                'is_dir': p.is_dir(),
                'size': p.stat().st_size if p.is_file() else 0
            })
        
        return {
            'success': True,
            'result': {
                'files': files,
                'count': len(files)
            }
        }
        
    except Exception as e:
        return {'success': False, 'error': str(e)}
```

**Schema**: åœ¨ `schemas.json` ä¸­æ·»åŠ 

```json
{
    "file_read": {
        "name": "file_read",
        "description": "è¯»å–æ–‡ä»¶å†…å®¹",
        "category": "file",
        "parameters": {
            "type": "object",
            "properties": {
                "path": {
                    "type": "string",
                    "description": "æ–‡ä»¶è·¯å¾„"
                },
                "encoding": {
                    "type": "string",
                    "description": "æ–‡ä»¶ç¼–ç ",
                    "default": "utf-8",
                    "enum": ["utf-8", "gbk", "ascii"]
                }
            },
            "required": ["path"]
        }
    },
    "file_list": {
        "name": "file_list",
        "description": "åˆ—å‡ºç›®å½•ä¸­çš„æ–‡ä»¶",
        "category": "file",
        "parameters": {
            "type": "object",
            "properties": {
                "path": {
                    "type": "string",
                    "description": "ç›®å½•è·¯å¾„",
                    "default": "."
                },
                "pattern": {
                    "type": "string",
                    "description": "æ–‡ä»¶åŒ¹é…æ¨¡å¼ï¼ˆglobï¼‰",
                    "default": "*"
                }
            }
        }
    }
}
```

### ç¤ºä¾‹ 2: æ•°æ®å¤„ç†å·¥å…·

**æ–‡ä»¶**: `builtin_tools/data_tools.py`

```python
"""
æ•°æ®å¤„ç†å·¥å…·é›†
"""

import json
import csv
from io import StringIO

def json_parse(params):
    """è§£æ JSON å­—ç¬¦ä¸²"""
    try:
        json_str = params.get('json_string', '')
        result = json.loads(json_str)
        return {'success': True, 'result': result}
    except json.JSONDecodeError as e:
        return {'success': False, 'error': f'JSON è§£æé”™è¯¯: {str(e)}'}


def json_stringify(params):
    """å°†å¯¹è±¡è½¬æ¢ä¸º JSON å­—ç¬¦ä¸²"""
    try:
        data = params.get('data')
        indent = params.get('indent', 2)
        json_str = json.dumps(data, indent=indent, ensure_ascii=False)
        return {'success': True, 'result': json_str}
    except Exception as e:
        return {'success': False, 'error': str(e)}


def csv_to_json(params):
    """å°† CSV è½¬æ¢ä¸º JSON"""
    try:
        csv_str = params.get('csv_string', '')
        delimiter = params.get('delimiter', ',')
        
        reader = csv.DictReader(StringIO(csv_str), delimiter=delimiter)
        result = list(reader)
        
        return {
            'success': True,
            'result': {
                'data': result,
                'count': len(result)
            }
        }
    except Exception as e:
        return {'success': False, 'error': str(e)}
```

---

## å·¥å…·æµ‹è¯•

### å•å…ƒæµ‹è¯•

**æ–‡ä»¶**: `tests/test_builtin_tools.py`

```python
"""
Built-in å·¥å…·å•å…ƒæµ‹è¯•
"""

import pytest
from builtin_tools.string_tools import string_reverse, string_to_upper

def test_string_reverse():
    """æµ‹è¯•å­—ç¬¦ä¸²åè½¬"""
    result = string_reverse({'text': 'hello'})
    assert result['success'] == True
    assert result['result'] == 'olleh'
    
def test_string_reverse_empty():
    """æµ‹è¯•ç©ºå­—ç¬¦ä¸²åè½¬"""
    result = string_reverse({'text': ''})
    assert result['success'] == True
    assert result['result'] == ''

def test_string_to_upper():
    """æµ‹è¯•è½¬å¤§å†™"""
    result = string_to_upper({'text': 'hello'})
    assert result['success'] == True
    assert result['result'] == 'HELLO'
```

è¿è¡Œæµ‹è¯•:
```bash
pytest tests/test_builtin_tools.py -v
```

### é›†æˆæµ‹è¯•

**æ–‡ä»¶**: `test_builtin_integration.py`

```python
"""
Built-in å·¥å…·é›†æˆæµ‹è¯•
"""

import requests

def test_builtin_tools_api():
    """æµ‹è¯• Built-in å·¥å…· API"""
    # 1. è·å–å·¥å…·åˆ—è¡¨
    resp = requests.get('http://localhost:5000/api/tools/builtin')
    assert resp.status_code == 200
    data = resp.json()
    assert data['success'] == True
    assert len(data['tools']) > 0
    
def test_tool_execution():
    """æµ‹è¯•å·¥å…·æ‰§è¡Œ"""
    # 2. æ‰§è¡Œå·¥å…·
    resp = requests.post('http://localhost:5000/api/tools/execute', json={
        'tool_name': 'string_reverse',
        'parameters': {'text': 'hello'}
    })
    assert resp.status_code == 200
    data = resp.json()
    assert data['success'] == True
    assert data['result'] == 'olleh'
```

---

## å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•è°ƒè¯•å·¥å…·ï¼Ÿ

**æ–¹æ³• 1**: ä½¿ç”¨ print è°ƒè¯•
```python
def my_tool(params):
    print(f"è°ƒè¯•: æ”¶åˆ°å‚æ•° {params}")
    result = process(params)
    print(f"è°ƒè¯•: ç»“æœ {result}")
    return {'success': True, 'result': result}
```

**æ–¹æ³• 2**: ä½¿ç”¨æ—¥å¿—
```python
import logging

logger = logging.getLogger(__name__)

def my_tool(params):
    logger.info(f"å·¥å…·è°ƒç”¨: {params}")
    try:
        result = process(params)
        logger.info(f"å·¥å…·æˆåŠŸ: {result}")
        return {'success': True, 'result': result}
    except Exception as e:
        logger.error(f"å·¥å…·å¤±è´¥: {e}", exc_info=True)
        return {'success': False, 'error': str(e)}
```

### Q2: å¦‚ä½•å¤„ç†è€—æ—¶æ“ä½œï¼Ÿ

ä½¿ç”¨å¼‚æ­¥æˆ–åå°ä»»åŠ¡:
```python
from threading import Thread

def long_running_tool(params):
    """è€—æ—¶å·¥å…·"""
    task_id = generate_task_id()
    
    def background_task():
        result = do_heavy_work(params)
        save_result(task_id, result)
    
    Thread(target=background_task).start()
    
    return {
        'success': True,
        'task_id': task_id,
        'status': 'processing',
        'message': 'ä»»åŠ¡å·²æäº¤ï¼Œè¯·ç¨åæŸ¥è¯¢ç»“æœ'
    }
```

### Q3: å¦‚ä½•é™åˆ¶å·¥å…·æƒé™ï¼Ÿ

```python
def secure_tool(params):
    """å®‰å…¨çš„å·¥å…·è°ƒç”¨"""
    # 1. æ£€æŸ¥è°ƒç”¨è€…æƒé™ï¼ˆéœ€è¦åœ¨ app.py ä¸­å®ç°è®¤è¯ï¼‰
    # user = get_current_user()
    # if not user.has_permission('use_secure_tool'):
    #     return {'success': False, 'error': 'æ— æƒé™'}
    
    # 2. é™åˆ¶å‚æ•°èŒƒå›´
    allowed_actions = ['read', 'list']
    action = params.get('action')
    if action not in allowed_actions:
        return {'success': False, 'error': f'ä¸å…è®¸çš„æ“ä½œ: {action}'}
    
    # 3. é™åˆ¶èµ„æºè®¿é—®
    path = params.get('path', '')
    if '..' in path or path.startswith('/'):
        return {'success': False, 'error': 'éæ³•è·¯å¾„'}
    
    # æ‰§è¡Œå®‰å…¨æ“ä½œ
    return {'success': True, 'result': '...'}
```

### Q4: å¦‚ä½•æ›´æ–°å·¥å…·è€Œä¸é‡å¯æœåŠ¡ï¼Ÿ

**é€‰é¡¹ 1**: çƒ­é‡è½½ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
```python
import importlib

def reload_tools():
    """é‡æ–°åŠ è½½æ‰€æœ‰å·¥å…·"""
    from builtin_tools import load_tools
    importlib.reload(load_tools)
    return {'success': True, 'message': 'å·¥å…·å·²é‡æ–°åŠ è½½'}
```

**é€‰é¡¹ 2**: ä½¿ç”¨è‡ªå®šä¹‰å·¥å…·ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- å¯¹äºéœ€è¦é¢‘ç¹æ›´æ–°çš„å·¥å…·ï¼Œä½¿ç”¨é¡µé¢é…ç½®çš„è‡ªå®šä¹‰å·¥å…·
- Built-in å·¥å…·ä¿ç•™ç»™ç¨³å®šçš„æ ¸å¿ƒåŠŸèƒ½

### Q5: å¦‚ä½•ç»„ç»‡å¤§é‡å·¥å…·ï¼Ÿ

**æ¨èç»“æ„**:
```
builtin_tools/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ schemas.json
â”œâ”€â”€ core/                   # æ ¸å¿ƒå·¥å…·
â”‚   â”œâ”€â”€ datetime_tools.py
â”‚   â”œâ”€â”€ math_tools.py
â”‚   â””â”€â”€ string_tools.py
â”œâ”€â”€ data/                   # æ•°æ®å¤„ç†
â”‚   â”œâ”€â”€ json_tools.py
â”‚   â”œâ”€â”€ csv_tools.py
â”‚   â””â”€â”€ xml_tools.py
â”œâ”€â”€ system/                 # ç³»ç»Ÿå·¥å…·
â”‚   â”œâ”€â”€ file_tools.py
â”‚   â””â”€â”€ process_tools.py
â””â”€â”€ external/               # å¤–éƒ¨APIé›†æˆ
    â”œâ”€â”€ weather_tools.py
    â””â”€â”€ search_tools.py
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **å·¥å…· API æ–‡æ¡£**: `TOOL_API.md`
- **å¿«é€Ÿå…¥é—¨**: `QUICKSTART_TOOLS.md`
- **MCP æŒ‡å—**: `MCP_GUIDE.md`
- **è‡ªåŠ¨å·¥å…·è§£æ**: `AUTO_TOOL_PARSE.md`

---

## ğŸ¯ ä¸‹ä¸€æ­¥

1. âœ… æŸ¥çœ‹ç°æœ‰ Built-in å·¥å…·: `app.py` ç¬¬ 305-360 è¡Œ
2. âœ… åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªå·¥å…·: å‚è€ƒ[å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
3. âœ… ç¼–å†™æµ‹è¯•: å‚è€ƒ[å·¥å…·æµ‹è¯•](#å·¥å…·æµ‹è¯•)
4. âœ… éƒ¨ç½²å’ŒéªŒè¯

---

**ç‰ˆæœ¬**: v1.0  
**æ›´æ–°æ—¥æœŸ**: 2024-12-03  
**ç»´æŠ¤è€…**: Development Team

